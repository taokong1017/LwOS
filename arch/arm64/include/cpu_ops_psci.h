#ifndef __ARM64_CPU_OPS_PSCI_H__
#define __ARM64_CPU_OPS_PSCI_H__

#include <types.h>
#include <kerrno.h>

/* PSCI version decoding (independent of PSCI version) */
#define PSCI_VERSION_MAJOR_SHIFT 16
#define PSCI_VERSION_MINOR_MASK ((1U << PSCI_VERSION_MAJOR_SHIFT) - 1)
#define PSCI_VERSION_MAJOR_MASK ~PSCI_VERSION_MINOR_MASK

#define PSCI_VERSION_MAJOR(ver)                                                \
	(((ver)&PSCI_VERSION_MAJOR_MASK) >> PSCI_VERSION_MAJOR_SHIFT)
#define PSCI_VERSION_MINOR(ver) ((ver)&PSCI_VERSION_MINOR_MASK)

#define PSCI_FN_NATIVE(version, name) PSCI_##version##_FN64_##name

/* PSCI v0.2 interface */
#define PSCI_0_2_FN_BASE 0x84000000
#define PSCI_0_2_FN(n) (PSCI_0_2_FN_BASE + (n))
#define PSCI_0_2_64BIT 0x40000000
#define PSCI_0_2_FN64_BASE (PSCI_0_2_FN_BASE + PSCI_0_2_64BIT)
#define PSCI_0_2_FN64(n) (PSCI_0_2_FN64_BASE + (n))
#define PSCI_0_2_FN_PSCI_VERSION PSCI_0_2_FN(0)
#define PSCI_0_2_FN_CPU_SUSPEND PSCI_0_2_FN(1)
#define PSCI_0_2_FN_CPU_OFF PSCI_0_2_FN(2)
#define PSCI_0_2_FN_CPU_ON PSCI_0_2_FN(3)
#define PSCI_0_2_FN_AFFINITY_INFO PSCI_0_2_FN(4)
#define PSCI_0_2_FN_MIGRATE PSCI_0_2_FN(5)
#define PSCI_0_2_FN_MIGRATE_INFO_TYPE PSCI_0_2_FN(6)
#define PSCI_0_2_FN_MIGRATE_INFO_UP_CPU PSCI_0_2_FN(7)
#define PSCI_0_2_FN_SYSTEM_OFF PSCI_0_2_FN(8)
#define PSCI_0_2_FN_SYSTEM_RESET PSCI_0_2_FN(9)
#define PSCI_0_2_FN64_CPU_SUSPEND PSCI_0_2_FN64(1)
#define PSCI_0_2_FN64_CPU_ON PSCI_0_2_FN64(3)
#define PSCI_0_2_FN64_AFFINITY_INFO PSCI_0_2_FN64(4)
#define PSCI_0_2_FN64_MIGRATE PSCI_0_2_FN64(5)
#define PSCI_0_2_FN64_MIGRATE_INFO_UP_CPU PSCI_0_2_FN64(7)
#define PSCI_0_2_FN64_SYSTEM_RESET PSCI_0_2_FN(9)

/* PSCI v1.0 interface */
#define PSCI_1_0_FN_BASE (0x84000000U)
#define PSCI_1_0_64BIT (0x40000000U)
#define PSCI_1_0_FN64_BASE (PSCI_1_0_FN_BASE + PSCI_1_0_64BIT)
#define PSCI_1_0_FN(n) (PSCI_1_0_FN_BASE + (n))
#define PSCI_1_0_FN64(n) (PSCI_1_0_FN64_BASE + (n))
#define PSCI_1_0_FN_PSCI_VERSION PSCI_1_0_FN(0)
#define PSCI_1_0_FN_CPU_SUSPEND PSCI_1_0_FN(1)
#define PSCI_1_0_FN_CPU_OFF PSCI_1_0_FN(2)
#define PSCI_1_0_FN_CPU_ON PSCI_1_0_FN(3)
#define PSCI_1_0_FN_AFFINITY_INFO PSCI_1_0_FN(4)
#define PSCI_1_0_FN_MIGRATE PSCI_1_0_FN(5)
#define PSCI_1_0_FN_MIGRATE_INFO_TYPE PSCI_1_0_FN(6)
#define PSCI_1_0_FN_MIGRATE_INFO_UP_CPU PSCI_1_0_FN(7)
#define PSCI_1_0_FN_SYSTEM_OFF PSCI_1_0_FN(8)
#define PSCI_1_0_FN_SYSTEM_RESET PSCI_1_0_FN(9)
#define PSCI_1_0_FN_PSCI_FEATURES PSCI_1_0_FN(10)
#define PSCI_1_0_FN64_CPU_SUSPEND PSCI_1_0_FN64(1)
#define PSCI_1_0_FN64_CPU_ON PSCI_1_0_FN64(3)
#define PSCI_1_0_FN64_AFFINITY_INFO PSCI_1_0_FN64(4)
#define PSCI_1_0_FN64_MIGRATE PSCI_1_0_FN64(5)
#define PSCI_1_0_FN64_MIGRATE_INFO_UP_CPU PSCI_1_0_FN64(7)
/* PSCI function ID is same for both 32 and 64 bit.*/
#define PSCI_1_0_FN64_SYSTEM_RESET PSCI_1_0_FN(9)
#define PSCI_1_0_FN64_PSCI_FEATURES PSCI_1_0_FN(10)

/* PSCI v1.1 interface. */
#define PSCI_1_1_FN_BASE (0x84000000U)
#define PSCI_1_1_64BIT (0x40000000U)
#define PSCI_1_1_FN64_BASE (PSCI_1_1_FN_BASE + PSCI_1_1_64BIT)
#define PSCI_1_1_FN(n) (PSCI_1_1_FN_BASE + (n))
#define PSCI_1_1_FN64(n) (PSCI_1_1_FN64_BASE + (n))
#define PSCI_1_1_FN_PSCI_VERSION PSCI_1_1_FN(0)
#define PSCI_1_1_FN_CPU_SUSPEND PSCI_1_1_FN(1)
#define PSCI_1_1_FN_CPU_OFF PSCI_1_1_FN(2)
#define PSCI_1_1_FN_CPU_ON PSCI_1_1_FN(3)
#define PSCI_1_1_FN_AFFINITY_INFO PSCI_1_1_FN(4)
#define PSCI_1_1_FN_MIGRATE PSCI_1_1_FN(5)
#define PSCI_1_1_FN_MIGRATE_INFO_TYPE PSCI_1_1_FN(6)
#define PSCI_1_1_FN_MIGRATE_INFO_UP_CPU PSCI_1_1_FN(7)
#define PSCI_1_1_FN_SYSTEM_OFF PSCI_1_1_FN(8)
#define PSCI_1_1_FN_SYSTEM_RESET PSCI_1_1_FN(9)
#define PSCI_1_1_FN_PSCI_FEATURES PSCI_1_1_FN(10)
#define PSCI_1_1_FN_SYSTEM_RESET2 PSCI_1_1_FN(18)
#define PSCI_1_1_FN64_CPU_SUSPEND PSCI_1_1_FN64(1)
#define PSCI_1_1_FN64_CPU_ON PSCI_1_1_FN64(3)
#define PSCI_1_1_FN64_AFFINITY_INFO PSCI_1_1_FN64(4)
#define PSCI_1_1_FN64_MIGRATE PSCI_1_1_FN64(5)
#define PSCI_1_1_FN64_MIGRATE_INFO_UP_CPU PSCI_1_1_FN64(7)
/* PSCI function ID is same for both 32 and 64 bit.*/
#define PSCI_1_1_FN64_SYSTEM_RESET PSCI_1_1_FN(9)
#define PSCI_1_1_FN64_PSCI_FEATURES PSCI_1_1_FN(10)
#define PSCI_1_1_FN64_SYSTEM_RESET2 PSCI_1_1_FN64(18)

/* PSCI return values (inclusive of all PSCI versions) */
#define PSCI_RET_SUCCESS 0
#define PSCI_RET_NOT_SUPPORTED -1
#define PSCI_RET_INVALID_PARAMS -2
#define PSCI_RET_DENIED -3
#define PSCI_RET_ALREADY_ON -4
#define PSCI_RET_ON_PENDING -5
#define PSCI_RET_INTERNAL_FAILURE -6
#define PSCI_RET_NOT_PRESENT -7
#define PSCI_RET_DISABLED -8
#define PSCI_RET_INVALID_ADDRESS -9

/* psci error code definition */
#define ERRNO_PSCI_SUCCESS ERRNO_OS_ERROR(MOD_ID_PSCI, 0x00)
#define ERRNO_PSCI_NOT_SUPPORTED ERRNO_OS_ERROR(MOD_ID_PSCI, 0x01)
#define ERRNO_PSCI_INVALID_PARAMS ERRNO_OS_ERROR(MOD_ID_PSCI, 0x02)
#define ERRNO_PSCI_DENIED ERRNO_OS_ERROR(MOD_ID_PSCI, 0x03)
#define ERRNO_PSCI_ALREADY_ON ERRNO_OS_ERROR(MOD_ID_PSCI, 0x04)
#define ERRNO_PSCI_ON_PENDING ERRNO_OS_ERROR(MOD_ID_PSCI, 0x05)
#define ERRNO_PSCI_INTERNAL_FAILURE ERRNO_OS_ERROR(MOD_ID_PSCI, 0x06)
#define ERRNO_PSCI_NOT_PRESENT ERRNO_OS_ERROR(MOD_ID_PSCI, 0x07)
#define ERRNO_PSCI_DISABLED ERRNO_OS_ERROR(MOD_ID_PSCI, 0x08)
#define ERRNO_PSCI_INVALID_ADDRESS ERRNO_OS_ERROR(MOD_ID_PSCI, 0x09)
#define ERRNO_PSCI_EMPTY_NAME ERRNO_OS_ERROR(MOD_ID_PSCI, 0x0a)
#define ERRNO_PSCI_INVALID_NAME ERRNO_OS_ERROR(MOD_ID_PSCI, 0x0b)
#define ERRNO_PSCI_NO_INITIALIZATION ERRNO_OS_ERROR(MOD_ID_PSCI, 0x0c)
#define ERRNO_PSCI_INVLAID_RESET_TYPE ERRNO_OS_ERROR(MOD_ID_PSCI, 0x0d)

enum arch_smccc_type { SMCCC_TYPE_NONE, SMCCC_TYPE_SMC, SMCCC_TYPE_HVC };

errno_t psci_init(const char *smccc_name);

#endif
